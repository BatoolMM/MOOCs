<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: exercise.controllers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: exercise.controllers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Question, Exercise, Video, Course } = require("../models/course.models")
const asyncWrapper = require("../utils/async_wrapper");
const { BadRequestError } = require("../utils/custom_errors");

// Create a new exercise
/**
 * Create new exercise
 * 
 * @param {string} title - Exercise title
 * @param {string} description - Exercise description
 * @param {string} course_id - Course id
 * 
 * @returns {MongooseObject} savedExercise
 * 
 * @throws {error} if an error occured
 */
exports.createExercise = asyncWrapper(
    async (req, res, next) => {
        const newExercise = new Exercise(req.body);
        const savedExercise = await newExercise.save();
        res.status(200).json(savedExercise);
    }
)

// Get exercises for a particular course - req.body.course_id = the id of the course you want to get exercises for
// Get exercises for all courses - req.body = {} // empty
// Get data for a particular exercise - req.body._id = exercise._id
/**
 * Get Exercises
 * 
 * @param {string} course_id - Course id
 * @param {string} _id - Exercise id
 * 
 * @returns {object} exercises
 * 
 * @throws {error} if an error occured
 */
exports.getExercises = asyncWrapper(
    async (req, res, next) => {
        if (req.body) {
            const exercises = await Exercise.find(req.body)
            res.status(200).json(exercises);
        }
        const exercises = await Exercise.find().sort({ _id: -1 })

        return res.status(200).send({ exercises: exercises })
    }
)

// Update data for a particular exercise
/**
 * Update exercise data
 * 
 * @access private
 * 
 * @param {string} id
 * 
 * @returns {string} message
 * @returns {object} exercise
 * 
 * @throws {error} if an error occured
 * @throws {BadRequestError} if exercise not found
 */
exports.updateExercise = asyncWrapper(
    async (req, res, next) => {
        const exercise = await Exercise.findById(req.params.id);

        if (exercise) {
            await exercise.updateOne({ $set: req.body });

            return res.status(200).json({ message: "Exercise Updated", exercise: exercise });
        }

        next(new BadRequestError("Exercise not found"));
    }
)

// Delete a particular exercise
/**
 * Delete exercise
 * 
 * @access private
 * 
 * @param {string} exerciseId
 * 
 * @returns {string} message
 * 
 * @throws {error} if an error occured
 * @throws {BadRequestError} if exercise not found
 * 
 * @todo delete all questions associated with the exercise
 * @todo delete all videos associated with the exercise
 * @todo delete all courses associated with the exercise
 * @todo delete all submissions associated with the exercise
 * @todo delete all submissions associated with the questions associated with the exercise
 * */
exports.deleteExercise = asyncWrapper(
    async (req, res, next) => {
        const exerciseId = req.params.exerciseId
        await Exercise.findByIdAndDelete(exerciseId)

        res.status(200).send({ message: "exercise has been deleted successfully" })
    }
)

// Add a question to an exercise
/**
 * Add question to exercise
 * 
 * @access private
 * 
 * @param {string} exercise_id
 * @param {string} question_id
 * 
 * @returns {string} message
 * 
 * @throws {error} if an error occured
 * */
exports.addQuestion = asyncWrapper(
    async (req, res, next) => {
        const exercise = await Exercise.findById(req.body.exercise_id)
        const question = await Question.findById(req.body.question_id)

        exercise.questions.push(question)
        await exercise.save()
        
        res.status(200).send({ message: "question has been added to exercise successfully" })
    }
)

// Remove a question from an exercise
/**
 * Remove question from exercise
 * 
 * @access private
 * 
 * @param {string} exerciseId
 * @param {string} questionId
 * 
 * @returns {string} message
 * 
 * @throws {error} if an error occured
 * */
exports.removeQuestion = asyncWrapper(
    async (req, res, next) => {
        const exerciseId = req.body.exerciseId
        const questionId = req.body.questionId
        const exercise = await Exercise.findById(exerciseId)
        exercise.questions.pull(questionId)
        await exercise.save()
        // await Question.findByIdAndDelete(questionId)
        res.status(200).send({ message: "question has been deleted from exercise successfully" })
    }
)


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#cancelEnrollment">cancelEnrollment</a></li><li><a href="global.html#createCourse">createCourse</a></li><li><a href="global.html#createExercise">createExercise</a></li><li><a href="global.html#createQuestion">createQuestion</a></li><li><a href="global.html#createToken">createToken</a></li><li><a href="global.html#deleteQuestion">deleteQuestion</a></li><li><a href="global.html#deleteVideo">deleteVideo</a></li><li><a href="global.html#forgetPassword">forgetPassword</a></li><li><a href="global.html#getCourses">getCourses</a></li><li><a href="global.html#getEnrolledCourses">getEnrolledCourses</a></li><li><a href="global.html#getEnrolledUsers">getEnrolledUsers</a></li><li><a href="global.html#getExercises">getExercises</a></li><li><a href="global.html#getLoggedInUser">getLoggedInUser</a></li><li><a href="global.html#getQuestions">getQuestions</a></li><li><a href="global.html#getVideo">getVideo</a></li><li><a href="global.html#googleSignin">googleSignin</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#scoreAnswers">scoreAnswers</a></li><li><a href="global.html#signToken">signToken</a></li><li><a href="global.html#signup">signup</a></li><li><a href="global.html#updateQuestion">updateQuestion</a></li><li><a href="global.html#updateVideo">updateVideo</a></li><li><a href="global.html#uploadVideo">uploadVideo</a></li><li><a href="global.html#verifyEmail">verifyEmail</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Tue Jan 03 2023 17:27:59 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
